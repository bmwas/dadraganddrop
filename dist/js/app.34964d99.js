(function(){"use strict";var e={977:function(e,t,n){var o=n(963),a=n(252),s=n(577),d=n(262),i=n(59),l=n(482),r=n(934);function c(){return(0,r.Z)()}const u={appearance:{x:0,y:0,width:100,height:100},gd:{type:"notice",content:null,variable:null}};class g{constructor(e){"undefined"==typeof e.id&&(e.id=c()),Object.assign(this,u,e)}is_node(){return!0}is_edge(){return!1}get_label(){return this.gd.variable??this.gd.content??this.id.substring(0,8)}get_content(){return this.gd.content??`[content of node ${this.id.substring(0,8)}]`}get_edges_in(){return this.graph.edges.filter((e=>e.node_to_id==this.id))}get_edges_out(){return this.graph.edges.filter((e=>e.node_from_id==this.id))}get_nodes_in(){const e=this.get_edges_in().map((e=>e.node_from_id))??[];return this.graph.nodes.filter((t=>e.includes(t.id)))}get_nodes_out(){const e=this.get_edges_out().map((e=>e.node_to_id))??[];return this.graph.nodes.filter((t=>e.includes(t.id)))}}const p={gd:{content:null}};class h{constructor(e){e.id=e.id??c(),Object.assign(this,p,e)}is_node(){return!1}is_edge(){return!0}get_node_from(){return this.graph.nodes.filter((e=>e.id==this.node_from_id))[0]}get_node_to(){return this.graph.nodes.filter((e=>e.id==this.node_to_id))[0]}}class _{constructor(e="Untitled graph"){(0,l.Z)(this,"name",void 0),(0,l.Z)(this,"nodes",[]),(0,l.Z)(this,"edges",[]),this.name=e}get_nodes_by_type(e){return this.nodes.filter((t=>t.gd.type==e))??[]}add_node(e){this.nodes.push(new g({...e,graph:this}))}add_edge(e){this.edges.push(new h({...e,graph:this}))}clear(){this.nodes=[],this.edges=[]}}var b=_;const f=(e="")=>null==e?null:{attrs:{text:{text:e}},position:{distance:.4}},v={attrs:{line:{strokeWidth:"1"}},zIndex:-1},m={grid:!0,background:{color:"white"},mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:"ctrl",minScale:.5,maxScale:3},scroller:{enabled:!0,pannable:!0},connecting:{allowBlank:!1,allowMulti:!1,allowLoop:!1,allowEdge:!1,allowNode:!1,allowPort:!0,highlight:!0,snap:!0,connector:"algo-connector",connectionPoint:"boundary",anchor:"top",validateMagnet({e:e,magnet:t,view:n,cell:o}){return"in"!==t.getAttribute("port-group")},createEdge(){return this.createEdge(v)},validateEdge({edge:e,type:t,previous:n}){return!0},validateConnection({edge:e,sourceMagnet:t,targetMagnet:n}){return null!=t&&null!=n&&("out"==t.getAttribute("port-group")&&"in"==n.getAttribute("port-group"))}},history:{enabled:!0,beforeAddCommand(e,t){if("tools"==t.key)return!1}},resizing:{enabled:!1},selecting:{enabled:!0,multiple:!1}};function y(e){e.on("node:mouseenter",(({cell:e})=>{e.addTools([{name:"button-remove"}])})),e.on("node:mouseleave",(({cell:e})=>{setTimeout((()=>{e.removeTool("button-remove")}),1e3)})),i.kJ.registerConnector("algo-connector",((e,t)=>{const n=4,o=Math.abs(t.y-e.y),a=Math.floor(o/3*2),s={x:e.x,y:e.y+n+a},d={x:t.x,y:t.y-n-a};return i.y$.normalize(`M ${e.x} ${e.y}\n            L ${e.x} ${e.y+n}\n            C ${s.x} ${s.y} ${d.x} ${d.y} ${t.x} ${t.y-n}\n            L ${t.x} ${t.y}\n            `)}),!0)}const w={in:{attrs:{circle:{r:6,stroke:"#6a6a6b",magnet:!0}},position:"top"},out:{attrs:{circle:{r:6,stroke:"#6a6a6b",magnet:!0}},position:"bottom"}};function k(e){const t={groups:w,items:[]};for(const n of e)t.items.push({id:`${n}-1`,group:n});return t}const x="notice",D={render(e){const t=e.getData();let n="",o="";return t.gd.variable?(n=t.gd.variable,o="node-label-variable"):t.gd.content?(n=`"${t.gd.content}"`,o="node-label-content"):(n=`unnamed ${t.gd.type} node`,o="node-label-unnamed"),`<div class="node node-${t.gd.type} ${t.errors?"node-has-errors":""}">\n                <span class="${o}">${n}</span>\n            </div>`},shouldComponentUpdate(e){return e.hasChanged("data")}},$={start:{antv_metadata:{shape:"html",html:D,width:180,height:36,data:{gd:Object.assign({},u.gd,{type:"start"})},ports:k(["out"])},config_fields:{general:["variable","label"],additional:[]}},decision:{antv_metadata:{shape:"html",html:D,width:180,height:36,data:{gd:Object.assign({},u.gd,{type:"decision"})},ports:k(["in","out"])},config_fields:{general:["variable","label"],additional:[]}},notice:{antv_metadata:{shape:"html",html:D,width:180,height:36,data:{gd:Object.assign({},u.gd,{type:"notice"})},ports:k(["in","out"])},config_fields:{general:["variable","label"],additional:[]}},end:{antv_metadata:{shape:"html",html:D,width:180,height:36,data:{gd:Object.assign({},u.gd,{type:"end"})},ports:k(["in"])},config_fields:{general:["variable","label"]}}};function C(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}const j={key:0},O=(0,a._)("span",{class:"block p-2 text-gray-700"},"Select a node or edge to configure",-1),S=[O],E={key:1,class:"w-full"},H={class:""},N={class:"m-2 font-bold block text-2xl border-b border-gray-300"},A={class:"p-2"},T={class:"p-2"},I={class:"my-2 block border-b border-gray-300 uppercase font-bold text-sm text-gray-800"},P={key:0},U=(0,a._)("span",{class:"text-gray-700 block mb-1"},"Variable",-1),q={key:1},z=(0,a._)("span",{class:"text-gray-700 block mb-1"},"Content",-1),Y={key:2,class:"w-full"},Z={class:""},L=(0,a._)("span",{class:"m-2 font-bold block text-2xl border-b border-gray-300"},"Edge",-1),M={class:"p-2"},F={key:0,class:"p-2"},J=(0,a._)("span",{class:"my-2 block border-b border-gray-300 uppercase font-bold text-sm text-gray-800"},"General",-1),R={class:"block mt-2"},V=(0,a._)("span",{class:"text-gray-700 block mb-1"},"Label",-1),G={class:"w-full my-2 text-right"},W={key:3},B=(0,a._)("span",null,"Invalid cell selected",-1),K=[B];var X=(0,a.aZ)({props:{cell:null},setup(e){const t=e,n=(0,a.Fl)((()=>{const e=t.cell?.getData()?.node_type??x;let n=null;return n=Object.keys($).includes(e)?$[e].config_fields:$[x].config_fields,Object.fromEntries(Object.entries(n).filter((([e,t])=>t.length>0)))})),i=(0,a.Fl)({get(){return t.cell.getData().gd.content??""},set(e){t.cell.setData({gd:{content:e}})}}),l=(0,a.Fl)({get(){return t.cell.getData().gd.variable??""},set(e){t.cell.setData({gd:{variable:""!=e?e:null}})}}),r=(0,d.iH)(""),c=(0,a.Fl)({get(){const e=t.cell;return r.value,e.getLabelAt(0)?.attrs?.text?.text?.toString()??""},set(e){const n=t.cell,o=f(e);null!=o&&(n.removeLabelAt(0),n.setLabelAt(0,o)),r.value=e,n.setData({value:e})}});return(t,r)=>null==e.cell?((0,a.wg)(),(0,a.iD)("div",j,S)):e.cell.isNode()?((0,a.wg)(),(0,a.iD)("div",E,[(0,a._)("div",H,[(0,a._)("span",N,(0,s.zw)((0,d.SU)(C)(e.cell.data.gd.type))+" node",1),(0,a._)("div",A,[(0,a._)("button",{onClick:r[0]||(r[0]=t=>e.cell?.remove()),class:"action-btn-remove"},"Remove")]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)((0,d.SU)(n),((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:t},[(0,a._)("div",T,[(0,a._)("span",I,(0,s.zw)(t),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e,class:"block mt-2 mb-1"},["variable"==e?((0,a.wg)(),(0,a.iD)("label",P,[U,(0,a._)("div",null,[(0,a.wy)((0,a._)("input",{class:"w-full",type:"text","onUpdate:modelValue":r[1]||(r[1]=e=>(0,d.dq)(l)?l.value=e:null)},null,512),[[o.nr,(0,d.SU)(l)]])])])):(0,a.kq)("",!0),"label"==e?((0,a.wg)(),(0,a.iD)("label",q,[z,(0,a._)("div",null,[(0,a.wy)((0,a._)("textarea",{style:{"min-height":"3rem"},class:"w-full",type:"text","onUpdate:modelValue":r[2]||(r[2]=e=>(0,d.dq)(i)?i.value=e:null)},null,512),[[o.nr,(0,d.SU)(i)]])])])):(0,a.kq)("",!0)])))),128))])])))),128))])])):e.cell.isEdge()?((0,a.wg)(),(0,a.iD)("div",Y,[(0,a._)("div",Z,[L,(0,a._)("div",M,[(0,a._)("button",{onClick:r[3]||(r[3]=t=>e.cell?.remove()),class:"action-btn-remove"},"Remove")]),"decision"==e.cell.getSourceCell()?.getData().gd.type?((0,a.wg)(),(0,a.iD)("div",F,[J,(0,a._)("div",R,[(0,a._)("label",null,[V,(0,a.wy)((0,a._)("input",{type:"text",class:"w-full","onUpdate:modelValue":r[4]||(r[4]=e=>(0,d.dq)(c)?c.value=e:null)},null,512),[[o.nr,(0,d.SU)(c)]])]),(0,a._)("div",G,[(0,a._)("button",{class:"inline btn mr-2",onClick:r[5]||(r[5]=e=>c.value="Yes")},"Yes"),(0,a._)("button",{class:"inline btn",onClick:r[6]||(r[6]=e=>c.value="No")},"No")])])])):(0,a.kq)("",!0)])])):((0,a.wg)(),(0,a.iD)("div",W,K))}});const Q=X;var ee=Q;const te={class:"shape-holder"},ne=["data-type"];var oe=(0,a.aZ)({props:{graph:null},setup(e){const t=e,n=(0,d.iH)();(0,a.bv)((()=>{})),(0,a.YP)((()=>t.graph),(e=>{"undefined"!==typeof e&&o(e)}));const o=e=>{n.value=new i.e9.Dnd({target:e,scaled:!1,animation:!0,validateNode(e,t){return!0}})},l=e=>{if("undefined"==typeof t.graph)return!1;const o=e.currentTarget,a=o.getAttribute("data-type");if(!(a in $))return!1;const s=t.graph.createNode($[a].antv_metadata);s.setData({label:a}),n.value?.start(s,e)};return(e,t)=>((0,a.wg)(),(0,a.iD)("div",te,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)((0,d.SU)($),((e,n)=>((0,a.wg)(),(0,a.iD)("div",{key:n,class:(0,s.C_)(`node node-${n}`),"data-type":n,onMousedown:t[0]||(t[0]=e=>l(e))},(0,s.zw)(n),43,ne)))),128))]))}});const ae=oe;var se=ae;function de(e,t=1,n=2){return e.map((e=>" ".repeat(2*t).concat(e)))}class ie{validate_graph(e){const t=[],n=e.get_nodes_by_type("start");1!==n.length&&t.push([`graph must have exactly one start node (has ${n.length})`]);const o=e.get_nodes_by_type("end");0===o.length&&t.push(["graph must have atleast one end node"]);const a={};for(const d of e.nodes){const e=this.da_node_get_id(d);e in a?(a[e].amount+=1,a[e].nodes.push(d)):a[e]={amount:1,nodes:[d]},"start"==d.gd.type&&1!==d.get_edges_out().length?t.push(["start node ",d,` must have 1 outgoing edge (has ${d.get_edges_out().length})`]):"decision"==d.gd.type&&0===d.get_edges_in().length?t.push(["decision node ",d," must have atleast one ingoing edge"]):"decision"==d.gd.type&&0===d.get_edges_out().length?t.push(["decision node ",d," must have atleast one outgoing edge"]):"notice"==d.gd.type&&0===d.get_edges_in().length?t.push(["notice node ",d," must have atleast one ingoing edge"]):"notice"==d.gd.type&&1!==d.get_edges_out().length?t.push(["notice node ",d," must have one outgoing edge"]):"end"==d.gd.type&&0===d.get_edges_in().length&&t.push(["end node ",d," must have atleast one ingoing edge"])}for(const[d,{amount:i,nodes:l}]of Object.entries(a)){console.log(d,i,l);const e=[];l.forEach(((t,n)=>{e.push(t),n<l.length-1&&e.push(", ")})),d.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)||t.push([`invalid (python) variable name '${d}' on the node(s): `,...e]),i>1&&t.push([`variable name '${d}' occurs is defined more than once, in the nodes: `,...e])}const s=e.get_nodes_by_type("decision");for(const d of s){let e=!1;const n={},o=d.get_edges_out();for(const t of o)null==t.gd.content&&(e=!0),null!=t.gd.content&&(n[t.gd.content]=n[t.gd.content]+1||1);e&&t.push(["decision node ",d," has atleast one outgoing edge with no content"]),Object.entries(n).forEach((([e,n])=>{if(n>1){const n=o.filter((t=>t.gd.content=e)),a=["the decision node ",d,` has multiple edges with content '${n[0].gd.content}' on the edges: `];n.forEach(((e,t)=>{a.push(e),t<n.length-1&&a.push(", ")})),t.push(a)}}))}if(0===t.length){const n=[],o=e.nodes.filter((e=>0===e.get_edges_in().length));let a=[...e.edges];while(o.length>0){const e=o.pop();n.push(e);for(const t of a.filter((t=>t.node_from_id==e.id))){const e=t.get_node_to();a=a.filter((e=>!(e.id==t.id))),0===a.filter((t=>t.node_to_id==e.id)).length&&o.push(e)}}a.length>0&&t.push(["graph must not contain cycles/loops"])}return t}da_node_get_id(e){return e.gd.variable??`${e.gd.type}_${e.id.toString().substring(0,8)}`}da_build_logic(e,t){const n=t.get_edges_out(),o=[];switch(t.gd.type){case"start":{o.push(`def get_outcome_${this.da_node_get_id(t)}():`),o.push(...de([this.da_node_get_id(t)]));const a=[];for(const t of n)a.push(...this.da_build_logic(e,t.get_node_to()));a.length>0?o.push(...de(a)):o.push(...de(["pass"])),o.push(`outcome = get_outcome_${this.da_node_get_id(t)}()`);break}case"end":o.push(`return ${this.da_node_get_id(t)}`);break;case"decision":for(const a of n){const n=a.gd.content;if(null==n)continue;const s=this.da_build_logic(e,a.get_node_to());o.push(`if ${this.da_node_get_id(t)} == '${a.gd.content}':`),o.push(...de(s||["pass"],1))}break;case"notice":o.push(`${this.da_node_get_id(t)}`);for(const t of n)o.push(...this.da_build_logic(e,t.get_node_to()));break}return o}out(e){const t=e.get_nodes_by_type("start")[0],n=e.get_nodes_by_type("end"),o=[];for(const d of e.nodes)switch(d.gd.type){case"start":o.push(["question: Start",`subquestion: '${d.get_content()}'`,`continue button field: ${this.da_node_get_id(d)}`]);break;case"end":break;case"decision":{const t=e.edges.filter((e=>e.node_from_id==d.id));let n=[];for(const e of t)null!=e.gd.content&&n.push(`  - "${e.gd.content}"`);n.sort(),n.length>0&&(n=["buttons:",...n]),o.push(["question: Question",`subquestion: '${d.get_content()}'`,`field: ${this.da_node_get_id(d)}`,...n]);break}case"notice":o.push(["question: Notice",`subquestion: '${d.get_content()}'`,`continue button field: ${this.da_node_get_id(d)}`]);break}const a=[];for(const d of n??[])a.push(...de([`${this.da_node_get_id(d)} = '${d.get_content()}'`]));a.push(...de(this.da_build_logic(e,t))),a.length>0&&o.push(["code: |",...a]),o.push(["mandatory: True","question: End","subquestion: ${outcome}"]);let s=o.map((e=>"string"==typeof e?e:Array.isArray(e)?e.join("\n"):void 0)).join("\n---\n");return s}}class le{in(e,t){e.clear();const n={nodes:t.getNodes(),edges:t.getEdges()};for(const o of n.nodes){const t=o.getData(),n={id:o.id,gd:t.gd,appearance:{x:o.getPosition().x??0,y:o.getPosition().y??0,width:o.getSize().width??$[t.gd.type].antv_metadata.width,height:o.getSize().height??$[t.gd.type].antv_metadata.height}};e.add_node(n)}for(const o of n["edges"]){if(null==o.getSourceCell()||null==o.getTargetCell())continue;let t=o.getLabelAt(0)?.attrs?.text?.text?.toString()??null;""==t&&(t=null);const n={id:o.id,node_from_id:o.getSourceCellId(),node_to_id:o.getTargetCellId(),gd:{content:t},appearance:{vertices:o.getVertices()}};e.add_edge(n)}return e}out(e){const t=[];let n=0;Object.values(e.nodes).forEach((e=>{let o={...$[e.gd.type].antv_metadata,id:e.id,x:e.appearance?.x??(n+=50),y:e.appearance?.y??50,data:{gd:e.gd}};o=Object.assign({},$[e.gd.type].antv_metadata??$.notice.antv_metadata??{},o),t.push(o)}));const o=[];Object.values(e.edges).forEach((e=>{const t=f(e.gd.content),n={...v,id:e.id,labels:null!=t?[t]:[],source:{cell:e.node_from_id,port:"out-1"},target:{cell:e.node_to_id,port:"in-1"},data:{gd:e.gd}};o.push(n)}));const a={nodes:t,edges:o};return a}}function re(e,...t){const n={};return t.forEach((t=>{n[t]=e[t]})),n}class ce{in_json(e,t){e.clear(),e.name=t.name;for(const n of t.nodes)e.add_node(n);for(const n of t.edges)e.add_edge(n);return e}out_json(e){const t={nodes:e.nodes.map((e=>re(e,"id","appearance","gd"))),edges:e.edges.map((e=>re(e,"id","node_from_id","node_to_id","gd"))),name:e.name};return t}}var ue=class{constructor(e){(0,l.Z)(this,"graph",void 0),(0,l.Z)(this,"json",void 0),(0,l.Z)(this,"antvis",void 0),(0,l.Z)(this,"docassemble",void 0),this.graph=e??new b,this.json=new ce,this.antvis=new le,this.docassemble=new ie}in_json(e){return this.graph=this.json.in_json(this.graph,e),this}out_json(){return this.json.out_json(this.graph)}in_antv(e){return this.graph=this.antvis.in(this.graph,e),this}out_antv(){return this.antvis.out(this.graph)}out_docassemble(){return this.docassemble.out(this.graph)}},ge=n(2);const pe={class:"toolbar"},he={class:"toolbar-item"},_e=["disabled"],be={class:"toolbar-item"},fe=["disabled"],ve={class:"toolbar-item"},me=["disabled"],ye={class:"toolbar-item"},we=["disabled"],ke={class:"toolbar-item"},xe=["disabled"];var De=(0,a.aZ)({props:{graph:{type:i.kJ},docassemble_cont_update:{type:Function},init_modeler:{type:Function}},setup(e){const t=e,n=(0,ge.pm)(),{Dnd:o}=i.e9,s=()=>{if(confirm("Are you sure you want to load the example flowchart?")){const e={nodes:[{id:"9ed5d853-62a0-4395-afb9-d94e8cffd2cd",appearance:{x:270,y:40,width:180,height:36},gd:{type:"start",content:"walk or bus?",variable:"walk_or_bus"}},{id:"b8bdd58d-ab1f-44d0-82b8-5edb21f3d484",appearance:{x:270,y:110,width:180,height:36},gd:{type:"decision",content:"is it raining?",variable:"is_raining"}},{id:"396a3b5e-a0cd-49c4-96c3-c65a8da0c483",appearance:{x:90,y:190,width:180,height:36},gd:{type:"notice",content:"take an umbrella",variable:"notice_take_umbrella"}},{id:"d9a60522-cc80-40bf-b691-5e51b27b0e6c",appearance:{x:90,y:260,width:180,height:36},gd:{type:"end",content:"take the bus",variable:"end_bus"}},{id:"20e3d21e-0799-4de7-8d1e-6cac260279ad",appearance:{x:470,y:260,width:180,height:36},gd:{type:"end",content:"take a walk",variable:"end_walk"}}],edges:[{id:"5106836e-d49c-4d33-9ed4-c6b5048ee11f",node_from_id:"b8bdd58d-ab1f-44d0-82b8-5edb21f3d484",node_to_id:"396a3b5e-a0cd-49c4-96c3-c65a8da0c483",gd:{content:"Yes"}},{id:"b81563a8-ad65-4d7e-86df-efbb0cf7fad4",node_from_id:"b8bdd58d-ab1f-44d0-82b8-5edb21f3d484",node_to_id:"20e3d21e-0799-4de7-8d1e-6cac260279ad",gd:{content:"No"}},{id:"3008df09-bacb-4a33-9b3e-8e248e858c2b",node_from_id:"396a3b5e-a0cd-49c4-96c3-c65a8da0c483",node_to_id:"d9a60522-cc80-40bf-b691-5e51b27b0e6c",gd:{content:null}},{id:"90c865d8-fbc3-4b7b-b0a3-46a8f1468c3e",node_from_id:"9ed5d853-62a0-4395-afb9-d94e8cffd2cd",node_to_id:"b8bdd58d-ab1f-44d0-82b8-5edb21f3d484",gd:{content:null}}],name:"Untitled graph"},n=(new ue).in_json(e).out_antv();t.graph?.fromJSON(n),t.docassemble_cont_update()}},d=()=>{const e=prompt("Enter the JSON you wish to import");if(e){const o=JSON.parse(e);if(o){const e=(new ue).in_json(o).out_antv();t.graph?.fromJSON(e),t.docassemble_cont_update()}else n.error("Failed to parse import")}},l=()=>{t.graph?.undo()},r=()=>{t.graph?.redo()},c=()=>{confirm("Are you sure you want to reset your workspace?")&&t.graph?.removeCells(t.graph.getCells())};return(t,n)=>((0,a.wg)(),(0,a.iD)("div",pe,[(0,a._)("div",he,[(0,a._)("button",{disabled:"undefined"===typeof e.graph,onClick:n[0]||(n[0]=e=>l())},"Undo",8,_e)]),(0,a._)("div",be,[(0,a._)("button",{disabled:"undefined"===typeof e.graph,onClick:n[1]||(n[1]=e=>r())},"Redo",8,fe)]),(0,a._)("div",ve,[(0,a._)("button",{disabled:"undefined"===typeof e.graph,onClick:n[2]||(n[2]=e=>c())},"Clear",8,me)]),(0,a._)("div",ye,[(0,a._)("button",{class:"bg-blue-200",disabled:"undefined"===typeof e.graph,onClick:n[3]||(n[3]=e=>d())},"Import JSON",8,we)]),(0,a._)("div",ke,[(0,a._)("button",{class:"bg-blue-200",disabled:"undefined"===typeof e.graph,onClick:n[4]||(n[4]=e=>s())},"Load default example",8,xe)])]))}});const $e=De;var Ce=$e;const je=(0,a._)("span",{class:"block font-medium mb-2"},"Validation errors",-1),Oe={class:"list-disc list-inside"},Se={key:1,class:"block text-green-800"};var Ee=(0,a.aZ)({props:{formatted_validation_errors:null},setup(e){const t=e;return(e,n)=>((0,a.wg)(),(0,a.iD)("div",{class:(0,s.C_)(["border border-gray-500 rounded mt-4 mb-2 py-2 px-3",{"bg-red-50":t.formatted_validation_errors.length>0}])},[t.formatted_validation_errors.length>0?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[je,(0,a._)("ul",Oe,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.formatted_validation_errors,((e,t)=>((0,a.wg)(),(0,a.iD)("li",{class:"validation-error text-red-900",key:t},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e,(e=>((0,a.wg)(),(0,a.iD)(a.HY,{key:e},[e.__v_isVNode?((0,a.wg)(),(0,a.j4)((0,a.LL)(e),{key:0})):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,s.zw)(e),1)],64))],64)))),128))])))),128))])],64)):((0,a.wg)(),(0,a.iD)("span",Se,"Graph contains no errors"))],2))}});const He=Ee;var Ne=He;const Ae={class:"mb-4"},Te=(0,a._)("h1",{class:"text-4xl font-serif inline"},"GraphDoc",-1),Ie={key:0,class:"text-sm"},Pe=(0,a._)("p",{class:"mt-2"}," This tool serves as a PoC to convert flowcharts (which can be represented as directed acyclic graphs) to docassemble interviews. The goal of this tool is to provide an intuitive interface for constructing docassemble interviews, in which relations and dependencies between nodes ('blocks') are more clearly visible. ",-1),Ue=(0,a._)("h2",{class:"text-lg font-serif mt-2 mb-1"},"Instructions",-1),qe=(0,a._)("p",null," Start by dragging nodes from the left sidebar. Connect nodes by dragging edges from and to the ports of the nodes. Configure nodes and edges by clicking on their cells and filling in the details in the config sidebar on the right. Nodes and edges can also be removed from this sidebar. If no output is produced, interpret the validation errors presented above the docassemble output window. For an example of a well structured graph, click on 'Load example'. ",-1),ze=[Pe,Ue,qe],Ye={class:"border border-gray-400 rounded overflow-hidden"},Ze={class:"w-full bg-gray-100"},Le={class:"w-full flex",style:{height:"500px"}},Me={class:"w-20 flex-initial bg-gray-100 border-t border-gray-200"},Fe=(0,a._)("div",{id:"modeler-container-box",class:"flex flex-grow border-4 border-b-0 border-gray-300"},[(0,a._)("div",{id:"modeler-container",style:{flex:"1"}})],-1),Je={class:"w-64 flex-initial bg-gray-100 border-t border-gray-200 overflow-y-auto"},Re={class:"my-4"},Ve=(0,a._)("span",{class:"text-lg block mb-1"},"Docassemble interview output",-1),Ge={class:"text-sm text-gray-700"},We=(0,a.Uk)(" Include a copy of the model "),Be={class:"relative"},Ke={class:"w-full min-h-4 font-mono border rounded p-2 mt-1 whitespace-pre-wrap",id:"docassemble_out_container"};var Xe=(0,a.aZ)({setup(e){const t=(0,d.iH)(!1);(0,a.bv)((()=>{v(),h()}));(0,d.iH)({});const n=(0,d.iH)(),l=(0,d.iH)();function r(e){"undefined"!==typeof e&&(l.value=e,n.value?.select(e),n.value?.scrollToCell(e))}const c=(0,d.iH)([]),u=(0,d.iH)([]),g=(0,d.iH)(""),p=(0,d.qj)({include_json_export:!0});(0,a.YP)((()=>p),(e=>{console.log("options updated"),h()}),{deep:!0});const h=()=>{if("undefined"==typeof n.value)return;const e=(new ue).in_antv(n.value);c.value=(new ie).validate_graph(e.graph),n.value.getCells().forEach((e=>"undefined"!==typeof e.getData()?.errors&&e.setData({errors:!1},{no_da_update:!0}))),u.value=c.value.map((e=>e.map((e=>{if("string"===typeof e)return e;if(e.is_node()){const t=e,o=n.value?.getCellById(t.id);return"undefined"!==typeof o?(o.setData({errors:!0},{no_da_update:!0}),(0,a.h)("span",{onClick(e){r(o)},class:"clickable-entity"},t.get_label())):`"${t.get_label()}""`}if(e.is_edge()){const t=e,o=n.value?.getCellById(t.id),s=t.gd.content?`with content ${t.gd.content}`:`leaving from node ${t.get_node_from().get_label()}`;return"undefined"!==typeof o?(0,a.h)("span",{onClick(e){r(n.value?.getCellById(t.gd.content?t.id:t.node_from_id))},class:"clickable-entity"},s):`"${s}"`}return""})))),0==u.value.length?(g.value=e.out_docassemble(),g.value&&p.include_json_export&&(g.value=g.value.concat("\n---\n# [START INLINE GRAPHDOC EXPORT]").concat("\n# ").concat(JSON.stringify(e.out_json())).concat("\n# [END INLINE GRAPHDOC EXPORT]"))):g.value="-"},_=(0,d.iH)("COPY"),b=()=>{window.getSelection().selectAllChildren(document.getElementById("docassemble_out_container")),navigator.clipboard.writeText(g.value).then((()=>{_.value="COPIED!",setTimeout((()=>{_.value="COPY"}),1200)})).catch((e=>{_.value="FAILED",setTimeout((()=>{_.value="COPY"}),1200),console.log("Failed to copy",e)}))},f=e=>{e.on("cell:change:*",(e=>{e.options.no_da_update||("target"==e.key?typeof e.current.cell!=typeof e.previous.cell&&h():["target","zIndex","tools","position"].includes(e.key)||h())})),e.on("cell:removed",h),e.on("cell:added",h),e.on("cell:selected",(({cell:e,options:t})=>{l.value!=e&&(l.value=e)})),e.on("cell:unselected",(({cell:e,options:t})=>{null!=l.value&&(l.value=void 0)})),e.on("blank:click",(({e:e,x:t,y:n})=>{null!=l.value&&(l.value=void 0)}))},v=()=>{let e=document.getElementById("modeler-container");e.scrollWidth,e.scrollHeight;n.value=new i.kJ({...m,container:e,autoResize:!0}),void 0!=n.value&&(y(n.value),f(n.value),h())};return(e,i)=>((0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",Ae,[(0,a._)("span",null,[Te,(0,a._)("button",{onClick:i[0]||(i[0]=e=>t.value=!t.value),class:"font-normal underline-offset-4 underline hover:no-underline pl-6 py-1 px-2 text-gray-600 hover:text-gray-900"},"read "+(0,s.zw)(t.value?"less":"more"),1)]),t.value?((0,a.wg)(),(0,a.iD)("div",Ie,ze)):(0,a.kq)("",!0)]),(0,a._)("div",Ye,[(0,a._)("div",Ze,[(0,a.Wm)(Ce,{graph:n.value,docassemble_cont_update:h,init_modeler:v},null,8,["graph"])]),(0,a._)("div",Le,[(0,a._)("div",Me,[null!==n.value?((0,a.wg)(),(0,a.j4)(se,{key:0,graph:n.value},null,8,["graph"])):(0,a.kq)("",!0)]),Fe,(0,a._)("div",Je,[(0,a.Wm)(ee,{cell:l.value},null,8,["cell"])])])]),(0,a.Wm)(Ne,{formatted_validation_errors:u.value},null,8,["formatted_validation_errors"]),(0,a._)("div",Re,[Ve,(0,a._)("label",Ge,[(0,a.wy)((0,a._)("input",{type:"checkbox",class:"mr-1","onUpdate:modelValue":i[1]||(i[1]=e=>(0,d.SU)(p).include_json_export=e)},null,512),[[o.e8,(0,d.SU)(p).include_json_export]]),We]),(0,a._)("div",Be,[(0,a._)("div",Ke,(0,s.zw)(g.value),1),(0,a._)("span",{class:"copy-button",onClick:i[2]||(i[2]=e=>b())},(0,s.zw)(_.value),1)])])],64))}});const Qe=Xe;var et=Qe;const tt={class:"mb-8 mt-4 mx-auto max-w-6xl"};var nt=(0,a.aZ)({setup(e){return(0,a.bv)((()=>{console.log("Editor window mounted.")})),(e,t)=>((0,a.wg)(),(0,a.iD)("div",tt,[(0,a.Wm)(et)]))}});const ot=nt;var at=ot;const st={class:""};var dt=(0,a.aZ)({setup(e){return(e,t)=>((0,a.wg)(),(0,a.iD)("div",st,[(0,a.Wm)(at)]))}});const it=dt;var lt=it;(0,o.ri)(lt).mount("#app")}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,o,a,s){if(!o){var d=1/0;for(c=0;c<e.length;c++){o=e[c][0],a=e[c][1],s=e[c][2];for(var i=!0,l=0;l<o.length;l++)(!1&s||d>=s)&&Object.keys(n.O).every((function(e){return n.O[e](o[l])}))?o.splice(l--,1):(i=!1,s<d&&(d=s));if(i){e.splice(c--,1);var r=a();void 0!==r&&(t=r)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[o,a,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var a,s,d=o[0],i=o[1],l=o[2],r=0;if(d.some((function(t){return 0!==e[t]}))){for(a in i)n.o(i,a)&&(n.m[a]=i[a]);if(l)var c=l(n)}for(t&&t(o);r<d.length;r++)s=d[r],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(c)},o=self["webpackChunkGraphDoc"]=self["webpackChunkGraphDoc"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(977)}));o=n.O(o)})();
//# sourceMappingURL=app.34964d99.js.map